# 其他笔记

## macos 安装 riscv 调试工具

参考：<https://pdos.csail.mit.edu/6.828/2022/tools.html>

```shell
brew tap riscv/riscv
brew install riscv-tools
```

安装后测试

```shell
riscv64-unknown-elf-gdb --version
```

output

```text
GNU gdb (GDB) 12.1
Copyright (C) 2022 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
```

## 为什么在\_\_switch 的时候，调用者保存的寄存器不用保存

> 属于调用者保存的寄存器是由编译器在高级语言编写的调用函数中自动生成的代码来完成保存的;
> 还有一些寄存器属于临时寄存器，不需要保存和恢复。

在内核中调用`__switch`的时候生成的保存调用者保存寄存器的逻辑，所以回来的时候，也是回到调用`__switch`之前的上下文

## 为何 C 语言 malloc 的时候不需要提供对齐需求？

在 C 语言中，所有对齐要求的最大值是一个平台相关的常数（比如 8 bytes），消耗少量内存即可使得每一次分配都符合这个最大的对齐要求。因此也就不需要区分不同分配的对齐要求了。而在 Rust 中，某些分配的对齐要求的值可能很大，就只能采用更加复杂的方法。

这里的某些指得是哪些？

TODO

## 第四章为什么是 jr 而不是 call trap_handler

因为trap_handler的地址，是用内核的虚拟地址空间表示的

## 为什么每个 app 都有个内核栈

## Linux 连续内存分配算法

## jemalloc 算法

## SLUB

TODO

https://www.oschina.net/news/217107/linux-wants-to-drop-slob

## MMU 和 TLB 为什么快
